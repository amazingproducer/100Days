<!DOCTYPE html>
<html lang="en">
<head>

<template>
  <div>
    <button type="button" class="btn btn-primary" @click.prevent="subscribe">{{ buttonText }}</button>
  </div>
</template>
<script>
export default {
  name: 'HomeActionBar',
  props: ['isSubscribedProp'],
  data() {
    return {
      isSubscribed: this.isSubscribedProp
    }
  },
  computed: {
    buttonText() {
      if (Notification.permission === 'denied') {
        window.longjacket.updateSubscriptionOnServer(null)
        return 'Notification Blocked'
      }

      if (!this.isSubscribed) {
        return 'Enable Push Notification'
      }
      return 'Disable Push Notification'
    },
  },
  methods: {
    subscribe() {
      if (Notification.permission === 'denied') {
        console.log('Notification is Blocked')
        return
      }

      if (this.isSubscribed) {
        window.longjacket.unsubscribe()
          .then((result) => {
            if (result) {
              console.log('Unsubscribe successful')
              this.isSubscribed = false
            }
          })
          .catch((error) => {
            console.log(error.message)
          })
      } else {
        window.longjacket.subscribe()
          .then((result) => {
            if (result) {
              console.log('Subscribe successful')
              this.isSubscribed = true
            }
          })
          .catch((error) => {
            // use null to trigger update if user block notification
            this.isSubscribed = null
            console.log(error.message)
          })
      }
    },
  }
}
</script>


<script src="https://unpkg.com/axios/dist/axios.min.js" type="module"></script>
<script src="./app.js" type="module"></script>
<link rel="manifest" href="/manifest.webmanifest">
</head>
<body>
    LooooooongLoooooong Jacket
</body>
<script>
if ('serviceWorker' in navigator && 'PushManager' in window) {
  console.log('Service Worker and Push is supported');

  navigator.serviceWorker.register('/sw-push-notification.js')
      .then(function(registration) {
        console.log('Service Worker is registered', registration);
        // i am totally using borrowed code for now
        // our PushManager helper methods
        window.longjacket.checkSubscription(registration);
      })
      .catch(function(error) {
        console.error('Service Worker Error', error);
      });
} else {
  console.warn('Push messaging is not supported');
}
</script>


</html>
